.. _bk_config_ota:

OTA 配置
========================

:link_to_translation:`en:[English]`

OTA 主要用于配置打包与防版本降级攻击的安全计数器。

OTA 配置表
----------------------------

OTA 配置表为 CSV 文件，下面为一个配置示例：

+--------------------+------------+--------------------+---------+
| Bin                | Version    | SecurityCounter    | OTA     |
+====================+============+====================+=========+
| bl2.bin            |            | 1                  | FALSE   |
+--------------------+------------+--------------------+---------+
| tfm_s.bin          |            | 1                  | TRUE    |
+--------------------+------------+--------------------+---------+
| cpu0_app.bin       |            | 1                  | TRUE    |
+--------------------+------------+--------------------+---------+

分区表固定为四列：

 - ``Bin`` - 必选项，表示可执行进进制文件名字。对于特定进进制文件 xx.bin，其对应的 OTA 分区名字为 secondary_xx，参考 :ref:`分区命名规则 <bk_config_partitions_table>`。
 - ``Version`` - 可选项，一般不需要配置。
 - ``SecurityCounter`` - 可选项，表示版本安全计数器。安全启动使能时必须配置，用于防止版本降级攻击。安全启动验证版本合法之后
   会读取该值，与 OTP/NV 中的安全计数器作比较，仅当升级版本的安全计数器不小于 OTP/NV 中的值时才允许启动。
 - ``OTA`` - 可选项。表示对应的 Bin 是否要打包在 ota.bin 中。 

.. note::

  1. partitions.csv 中 secondary 为前缀的分区才允许做 OTA。分区有 OTA 能力时，才能在 ota.csv 中配置是否进行 OTA。
  2. 应用分区 ``SecurityCounter`` 与 ``OTA`` 配置必须一致。
